# Migration `20200926234751-crossing_dev`

This migration has been generated by Dennis Dang at 9/26/2020, 11:47:51 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."MessagesOnEvents" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"deletedAt" timestamp(3)   ,"eventId" integer  NOT NULL ,"messageId" integer  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("messageId","eventId"))

ALTER TABLE "public"."Message" ADD COLUMN "type" text  NOT NULL ;

CREATE UNIQUE INDEX "MessagesOnEvents.messageId_eventId" ON "public"."MessagesOnEvents"("messageId","eventId")

ALTER TABLE "public"."MessagesOnEvents" ADD FOREIGN KEY ("messageId")REFERENCES "public"."Message"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."MessagesOnEvents" ADD FOREIGN KEY ("eventId")REFERENCES "public"."Event"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200926234108-crossing_dev..20200926234751-crossing_dev
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
     provider = "postgresql"
-    url = "***"
+    url      = "postgresql://postgres:postgres@localhost:5432/crossing_dev"
 }
 generator db {
     provider = "go run github.com/prisma/prisma-client-go"
@@ -108,19 +108,19 @@
 }
 // An Event represents a moment in a story in which Avatars can fulfill Actions
 model Event {
-    id        Int       @default(autoincrement()) @id
-    createdAt DateTime  @default(now())
-    deletedAt DateTime?
-    updatedAt DateTime  @updatedAt
-    story     Story     @relation(fields: [storyId], references: [id])
-    storyId   Int
+    id               Int                @default(autoincrement()) @id
+    createdAt        DateTime           @default(now())
+    deletedAt        DateTime?
+    updatedAt        DateTime           @updatedAt
+    story            Story              @relation(fields: [storyId], references: [id])
+    storyId          Int
     // The sequence dictates the order of events to occur in a story
-    sequence  Int
-    Action    Action[]
+    sequence         Int
+    Action           Action[]
+    MessagesOnEvents MessagesOnEvents[]
-
     @@unique([storyId, sequence])
 }
 // An Action prescribes a message and the raid member position required to fulfill the action.
@@ -144,11 +144,14 @@
     createdAt         DateTime            @default(now())
     deletedAt         DateTime?
     updatedAt         DateTime            @updatedAt
     content           String
+    type              String
     MessagesOnActions MessagesOnActions[]
+    MessagesOnEvents  MessagesOnEvents[]
 }
+// An Action may send messages to users.
 model MessagesOnActions {
     createdAt DateTime  @default(now())
     deletedAt DateTime?
     updatedAt DateTime  @updatedAt
@@ -159,4 +162,18 @@
     @@id([messageId, actionId])
     @@unique([messageId, actionId])
 }
+
+// An Event may send messages to users on completion.
+model MessagesOnEvents {
+    createdAt DateTime  @default(now())
+    deletedAt DateTime?
+    updatedAt DateTime  @updatedAt
+    message   Message   @relation(fields: [messageId], references: [id])
+    messageId Int
+    event     Event     @relation(fields: [eventId], references: [id])
+    eventId   Int
+
+    @@id([messageId, eventId])
+    @@unique([messageId, eventId])
+}
```


