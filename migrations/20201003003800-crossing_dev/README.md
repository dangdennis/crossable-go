# Migration `20201003003800-crossing_dev`

This migration has been generated by Dennis Dang at 10/3/2020, 12:38:00 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."Action.eventId_position"

ALTER TABLE "public"."Action" DROP COLUMN "taken";

CREATE UNIQUE INDEX "Action.eventId_avatarId" ON "public"."Action"("eventId","avatarId")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200927212252-crossing_dev..20201003003800-crossing_dev
--- datamodel.dml
+++ datamodel.dml
@@ -1,15 +1,15 @@
 datasource db {
     provider = "postgresql"
-    url = "***"
+    url      = "postgresql://postgres:postgres@localhost:5432/crossing_dev"
 }
 generator db {
     provider = "go run github.com/prisma/prisma-client-go"
 }
 model User {
-    id              Int       @default(autoincrement()) @id
+    id              Int       @id @default(autoincrement())
     createdAt       DateTime  @default(now())
     deletedAt       DateTime?
     updatedAt       DateTime  @updatedAt
     discordUserId   String    @unique
@@ -20,9 +20,9 @@
     avatar          Avatar?
 }
 model Avatar {
-    id             Int              @default(autoincrement()) @id
+    id             Int              @id @default(autoincrement())
     createdAt      DateTime         @default(now())
     deletedAt      DateTime?
     updatedAt      DateTime         @updatedAt
     User           User             @relation(fields: [userId], references: [id])
@@ -31,9 +31,9 @@
     Action         Action[]
 }
 model Raid {
-    id                 Int                 @default(autoincrement()) @id
+    id                 Int                 @id @default(autoincrement())
     createdAt          DateTime            @default(now())
     deletedAt          DateTime?
     updatedAt          DateTime            @updatedAt
     startTime          DateTime            @default(now())
@@ -48,9 +48,9 @@
     RaidBossesOnRaids  RaidBossesOnRaids[]
 }
 model RaidBoss {
-    id                Int                 @default(autoincrement()) @id
+    id                Int                 @id @default(autoincrement())
     createdAt         DateTime            @default(now())
     deletedAt         DateTime?
     updatedAt         DateTime            @updatedAt
     name              String              @unique
@@ -68,9 +68,8 @@
     avatar    Avatar    @relation(fields: [avatarId], references: [id])
     avatarId  Int
     @@id([raidId, avatarId])
-
 }
 model RaidBossesOnRaids {
     createdAt  DateTime  @default(now())
@@ -81,14 +80,13 @@
     raidBoss   RaidBoss  @relation(fields: [raidBossId], references: [id])
     raidBossId Int
     @@id([raidId, raidBossId])
-
 }
 // A Story is a series of events that can occur for a given raid
 model Story {
-    id        Int       @default(autoincrement()) @id
+    id        Int       @id @default(autoincrement())
     createdAt DateTime  @default(now())
     deletedAt DateTime?
     updatedAt DateTime  @updatedAt
     active    Boolean   @default(true)
@@ -97,9 +95,9 @@
 }
 // An Event represents a moment in a story in which Avatars can fulfill Actions
 model Event {
-    id               Int                @default(autoincrement()) @id
+    id               Int                @id @default(autoincrement())
     createdAt        DateTime           @default(now())
     deletedAt        DateTime?
     updatedAt        DateTime           @updatedAt
     story            Story              @relation(fields: [storyId], references: [id])
@@ -112,29 +110,27 @@
     @@unique([storyId, sequence])
 }
-// An Action prescribes a message and the raid member position required to fulfill the action.
-// This allows for customized actions per raid member. Wowzah!
+// An Action indicates that an Avatar has taken action for an Event
 model Action {
-    id                Int                 @default(autoincrement()) @id
+    id                Int                 @id @default(autoincrement())
     createdAt         DateTime            @default(now())
     deletedAt         DateTime?
     updatedAt         DateTime            @updatedAt
     position          Int
     event             Event               @relation(fields: [eventId], references: [id])
     eventId           Int
-    actor             Avatar              @relation(fields: [avatarId], references: [id])
+    avatar            Avatar              @relation(fields: [avatarId], references: [id])
     avatarId          Int
-    taken             Boolean             @default(false)
     MessagesOnActions MessagesOnActions[]
-    @@unique([eventId, position])
+    @@unique([eventId, avatarId])
 }
 // A Message holds message contents.
 model Message {
-    id                Int                 @default(autoincrement()) @id
+    id                Int                 @id @default(autoincrement())
     createdAt         DateTime            @default(now())
     deletedAt         DateTime?
     updatedAt         DateTime            @updatedAt
     content           String
@@ -153,9 +149,8 @@
     action    Action    @relation(fields: [actionId], references: [id])
     actionId  Int
     @@id([messageId, actionId])
-
 }
 // An Event may send messages to users on completion.
 model MessagesOnEvents {
```


