# Migration `20200927205915-crossing_dev`

This migration has been generated by Dennis Dang at 9/27/2020, 8:59:15 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Story" ADD COLUMN "storyId" integer  NOT NULL ;

ALTER TABLE "public"."StoriesOnRaids" DROP CONSTRAINT IF EXiSTS "StoriesOnRaids_raidId_fkey";

ALTER TABLE "public"."StoriesOnRaids" DROP CONSTRAINT IF EXiSTS "StoriesOnRaids_storyId_fkey";

ALTER TABLE "public"."Story" ADD FOREIGN KEY ("storyId")REFERENCES "public"."Story"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."StoriesOnRaids";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200927204821-crossing_dev..20200927205915-crossing_dev
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
     provider = "postgresql"
-    url = "***"
+    url      = "postgresql://postgres:postgres@localhost:5432/crossing_dev"
 }
 generator db {
     provider = "go run github.com/prisma/prisma-client-go"
@@ -43,9 +43,8 @@
     playerLimit        Int                 @default(10)
     playerCount        Int                 @default(0)
     AvatarsOnRaids     AvatarsOnRaids[]
     RaidBossesOnRaids  RaidBossesOnRaids[]
-    StoriesOnRaids     StoriesOnRaids[]
 }
 model RaidBoss {
     id                Int                 @default(autoincrement()) @id
@@ -85,29 +84,17 @@
 }
 // A Story is a series of events that can occur for a given raid
 model Story {
-    id             Int              @default(autoincrement()) @id
-    createdAt      DateTime         @default(now())
-    deletedAt      DateTime?
-    updatedAt      DateTime         @updatedAt
-    active         Boolean          @default(true)
-    StoriesOnRaids StoriesOnRaids[]
-    Event          Event[]
-}
-
-// A Raid may have multiple stories in succession
-model StoriesOnRaids {
+    id        Int       @default(autoincrement()) @id
     createdAt DateTime  @default(now())
     deletedAt DateTime?
     updatedAt DateTime  @updatedAt
-    raid      Raid      @relation(fields: [raidId], references: [id])
-    raidId    Int
-    story     Story     @relation(fields: [storyId], references: [id])
+    active    Boolean   @default(true)
+    story     Story     @relation("StoryToStory", fields: [storyId], references: [id])
     storyId   Int
-
-    @@id([raidId, storyId])
-
+    Event     Event[]
+    Story     Story[]   @relation("StoryToStory")
 }
 // An Event represents a moment in a story in which Avatars can fulfill Actions
 model Event {
```


